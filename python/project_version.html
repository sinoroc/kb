
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Python project version single-sourcing &#8212; Sinoroc KB</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python project name" href="project_name.html" />
    <link rel="prev" title="Python packaging" href="packaging.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="python-project-version-single-sourcing">
<h1>Python project version single-sourcing<a class="headerlink" href="#python-project-version-single-sourcing" title="Permalink to this heading">¶</a></h1>
<section id="problem">
<h2>Problem<a class="headerlink" href="#problem" title="Permalink to this heading">¶</a></h2>
<p>It is not entirely straightforward where the version string should be written
within a Python project.</p>
<p>A couple of things are sure:</p>
<ul class="simple">
<li><p>the version must be written in a <code class="docutils literal notranslate"><span class="pre">__version__</span></code> attribute as a string
(see <a class="reference external" href="https://www.python.org/dev/peps/pep-0396/">PEP 396</a>)</p></li>
<li><p>the version string must be available from the setup script</p></li>
<li><p>the version string should be in the changelog</p></li>
</ul>
<p>It is annoying to have to keep the version string up to date in these three
locations. A solution for single-sourcing the project version would fix that.</p>
</section>
<section id="solution">
<h2>Solution<a class="headerlink" href="#solution" title="Permalink to this heading">¶</a></h2>
<p>This solution shows how to keep the Python project version string in just one
place. The suggested location is in the change log:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">CHANGELOG.rst</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-restructuredtext notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="linenos">0</span><span class="gh">1.2.3</span>
</span><span class="linenos">1</span><span class="gh">=====</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="m">*</span> More bugs fixed
<span class="linenos">4</span>
<span class="linenos">5</span><span class="gh">1.2.2</span>
<span class="linenos">6</span><span class="gh">=====</span>
<span class="linenos">7</span>
<span class="linenos">8</span><span class="m">*</span> Bugs fixed
</pre></div>
</div>
</div>
<p>The current version string should always be on the same line and on its own so
that the setup script can easily find it and extract it:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">setup.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">setuptools</span>

<span class="hll"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">HERE</span><span class="p">,</span> <span class="s1">&#39;CHANGELOG.rst&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
</span><span class="hll">    <span class="n">changelog</span> <span class="o">=</span> <span class="n">file_</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span>
<span class="n">setuptools</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
<span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Example&#39;</span><span class="p">,</span>
</span><span class="hll">    <span class="n">version</span><span class="o">=</span><span class="n">changelog</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>
</span>    <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>From the actual code of the project the version number should be accessed via
<code class="docutils literal notranslate"><span class="pre">importlib.metadata</span></code>. Knowing the name of the project it is easy to get the
version string:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">src/example/__init__.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">importlib.metadata</span>

<span class="hll"><span class="n">__version__</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">version</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
</span></pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">importlib.metadata</span></code> package is part of the standard library starting
with <em>Python 3.8</em>. For earlier versions use <a class="reference external" href="https://pypi.org/project/importlib-metadata/">importlib-metadata</a> instead.</p>
<p>As a positive side effect, changing the version number forces the project
maintainer to modify the change log and thus they always get at least one
chance to keep it up to date.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h1 class="logo">
 <a href="../index.html">
  Sinoroc KB
 </a>
</h1>
<p class="blurb">
 Bits of knowledge
</p>



<h3><a href="../contents.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Foreword</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Python</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="package_data.html">Python package data</a></li>
<li class="toctree-l2"><a class="reference internal" href="packaging.html">Python packaging</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python project version single-sourcing</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_name.html">Python project name</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_imports.html">Python imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytest.html">pytest</a></li>
<li class="toctree-l2"><a class="reference internal" href="tox.html">tox</a></li>
<li class="toctree-l2"><a class="reference internal" href="pex.html">pex</a></li>
<li class="toctree-l2"><a class="reference internal" href="setuptools.html">setuptools</a></li>
<li class="toctree-l2"><a class="reference internal" href="chameleon.html">Chameleon</a></li>
<li class="toctree-l2"><a class="reference internal" href="working.html">Working with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="fizz_buzz.html">Fizz buzz</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docker/index.html">Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
      
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/python/project_version.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>